

# Лабораторная работа №4  
## «Средства постэксплуатации»

Дисциплина: «Защита программного обеспечения защищенных автоматизированных систем»  

Выполнил: Воробьев Павел

---

## Цель работы

разобрать работу Command&Control -фреймворков

---



## Ход работы
### 1. Описание Фреймворка 

AdaptixC2 — это расширяемая платформа для постэксплуатации и состязательной эмуляции, созданная для специалистов по тестированию на проникновение. Сервер Adaptix написан на Golang, что обеспечивает гибкость для операторов. Клиент с графическим интерфейсом написан на C++ QT, что позволяет использовать его в операционных системах Linux, Windows и MacOS.

Принцип работы в боевом режиме выглядит следующим образом:

Атакующий разворачивает team server, подключается к нему через клиент. В клиенте создается полезная нагрузка и настраивается listener, который будет ожидать входящие соединения от агентов.

Далее необходимо доставить полезную нагрузку на необходимую систему. После запуска полезной нагрузки она связывается с team server. На этом этапе атакующий может взаимодействовать с агентом через графический интерфейс клиента.

Особенности:

-Серверно-клиентская архитектура для поддержки многопользовательской игры

-Кроссплатформенный клиент с графическим интерфейсом

-Полностью зашифрованные коммуникации

-Прослушиватель и агенты в качестве плагина (расширителя)

-Хранилище задач и заданий

-Браузеры файлов и процессов

-Менеджеры учетных данных, целей и скриншотов

-Поддержка авторизации Socks4 / Socks5 / Socks55

-Поддержка локальной и обратной переадресации портов

-Поддержка BOF

-Привязка агентов и графика сеансов

-Проверка работоспособности агентов

-Контроль даты завершения работы агентов и рабочего времени агентов

-Поддержка агентов Windows /Linux/ macOS

-Удаленный терминал

-Движок AxScript

Инсирукция по установке и настройке фремворка представлена в документации: https://adaptix-framework.gitbook.io/adaptix-framework

---


### 2. Использование в режиме listener

Во первых, нужно подключиться с клиента к самому серверу. IP адрес -адрес машины, порт назначен нестандартный, чтобы избежать  конфликтов с другими службами. Также указан конечный путь /endpoint, который является точкой входа для API-запросов.
<img width="784" height="393" alt="image" src="https://github.com/user-attachments/assets/be7997d6-c96f-43d3-bbbc-d2389181abef" />

Далее был создан listener со следующими параметрами:  

-Слушатель с именем "TCP", использующий внешний TCP-протокол и относящийся к типу GopherTCP, что указывает на специализированную реализацию для установки прямых TCP-сессий с агентами.

-IP-адрес и порт для привязки службы: 192.168.170.128 и порт 4321.

- цель запроса определена как путь /POST.PHP, что имитирует передачу данных обычной веб-формы.

- Для маскировки под обычную службу используется TCP-баннер "AdaptixC2 server"

Важным элементом является строка пользовательского агента, которая имитирует браузер Firefox версии 20.0 под управлением Windows NT 6.2
<img width="642" height="666" alt="image" src="https://github.com/user-attachments/assets/56551997-1892-40bd-a8cc-010c770491cd" />

На этом скриншоте представлен интерфейс генерации агента, который является вредоносной полезной нагрузкой, предназначенной для установки на целевую систему. Агент создаётся для работы со слушателем типа HTTP. Выбранный тип агента — beacon, что подразумевает его периодическое подключение к серверу для получения инструкций, а не поддержание постоянного соединения, что делает его менее заметным для систем обнаружения.

<img width="545" height="472" alt="image" src="https://github.com/user-attachments/assets/d195127b-2cec-4d6a-9227-69892ab08c83" />


Агент прпедставлен ввиде исполняемого файла .exe

После настройки слушателя и генерации вредоносного агента в формате исполняемого файла для 64-битных систем Windows оператор переходит к этапу доставки полезной нагрузки до целевых систем. Для этого был развернут веб-сервер Apache на контролируемой инфраструктуре с IP-адресом 10.0.2.15. Этот сервер был настроен таким образом, чтобы разместить сгенерированный вредоносный файл и обеспечить его доступность для загрузки через HTTP-протокол. Использование популярного и легитимного веб-сервера позволяет замаскировать передачу вредоносного кода под обычный веб-трафик.


### 3. Запуск сгенерированной полезной нагрузки на виртуальной машине под управлением Windows 10

На скриншоте представлена загрузка вредоносного агента на атакуемой ВМ. Для выполнения работы был отключен Windows Defender. 

<img width="1283" height="138" alt="image" src="https://github.com/user-attachments/assets/1d81b59e-3b64-46af-b8b1-1d8005e1d53e" />

На данном скриншоте отображён интерфейс журнала  системы командования и управления, в котором представлены результаты работы вредоносного агента на скомпрометированной системе. Агент, ранее внедрённый на целевую машину, выполнил команду обследования файловой системы и передал данные о структуре каталогов и файлов оператору. В левой части интерфейса показано дерево директорий, начиная с корневого диска C:, с переходом в папку пользователя, рабочий стол и конкретные каталоги, что указывает на успешный доступ агента к файлам на атакуемой машине.

<img width="1701" height="816" alt="image" src="https://github.com/user-attachments/assets/286c1b7c-db4f-4e3d-a956-5c2bb88c5a4c" />


### Вывод

Проделанная работа наглядно демонстрирует полный цикл подготовки и применения системы командования и управления.  Была смоделирована инфраструктура атаки: настроены слушатели  для приема соединений от агентов, сгенерирована вредоносная полезная нагрузка  с механизмами маскировки, обеспечена её доставка через легитимный веб-сервер Apache. Внедрение агента на целевую систему позволило получить удалённый контроль, подтверждённый успешным сбором данных о файловой системе атакуемой машины. 
